require '../tools/readJSON'
require '../tools/csv2json'
require '../tools/excel2csv'
require 'csv'
require 'json'
require 'time'
require "json-diff"
require "hashdiff"
require 'yomu'

curren_dir = File.dirname(__FILE__)

puts "current directory: #{curren_dir}"

@converted_json_dir = "#{curren_dir}/../converted_json/"

@dt4_formula_json = "dt4_seed_data_formula.json"

#15 ---- no need to execute following sql insert query
def insert_webservice_access_log(seedTrialID)
     @seed_json_data = read_json_from_dir(@converted_json_dir, @dt4_formula_json)
     @seed_data = @seed_json_data.find {|x| x['seedTrialID'] == "#{seedTrialID}"}
     puts @seed_data
sql_insert_webservice_access_log =
    "
      INSERT INTO webservice_access_log (identifier,datetime,client_ip,client_username,uri,method,headers,payload,response,response_code,processing_time,processing_errors) VALUES ('1618194','2018-02-21 08:34:32.99','172.18.0.1','ctrpsubstractor','/services/trials/complete/','POST','host=localhost:18080\nconnection=keep-alive\ncontent-length=4516\naccept=application/xml\npostman-token=8fe8effb-61da-a534-e4c5-a34613f33fec\ncache-control=no-cache\norigin=chrome-extension://fhbjgbiflinjbdggehcddcbncdddomop\nuser-agent=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/64.0.3282.167 Safari/537.36\nauthorization=*********\ncontent-type=application/xml\naccept-encoding=gzip, deflate, br\naccept-language=en-US,en;q=0.9\ncookie=JSESSIONID=syajca7WdyZiqoJN+WrkNoFO\n','<tns:CompleteTrialRegistration xmlns:tns=\"gov.nih.nci.pa.webservices.types\"\n                               xmlns:tns1=\"gov.nih.nci.po.webservices.types.trimmed\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n                               xsi:schemaLocation=\"gov.nih.nci.pa.webservices.types ../../src/resources/ws.xsd \">\n\n  <tns:clinicalTrialsDotGovXmlRequired>true</tns:clinicalTrialsDotGovXmlRequired>\n  <tns:leadOrgTrialID>UPCC 348-02 II - sa1</tns:leadOrgTrialID>\n  <tns:clinicalTrialsDotGovTrialID>NCT91914266</tns:clinicalTrialsDotGovTrialID>\n  <tns:otherTrialID>818280234</tns:otherTrialID>\n  <tns:title>A Phase I/II Study Of Brentuximab Vedotin In Combination With Multi-Agent Chemotherapy II</tns:title>\n  <tns:phase>I</tns:phase>\n  <tns:pilot>false</tns:pilot>\n  <tns:accrualDiseaseTerminology>ICD10</tns:accrualDiseaseTerminology>\n  <tns:primaryPurpose>Other</tns:primaryPurpose>\n  <tns:primaryPurposeOtherDescription>Determine maximum tolerated dose (MTD) of brentuximab vedotin</tns:primaryPurposeOtherDescription>\n  <tns:interventionalDesign>\n    <tns:secondaryPurpose>Other</tns:secondaryPurpose>\n    <tns:secondaryPurposeOtherDescription>Secondary Other Description</tns:secondaryPurposeOtherDescription>\n  </tns:interventionalDesign>\n  <tns:leadOrganization>\n    <tns:existingOrganization>\n      <tns:poID>181802</tns:poID>\n    </tns:existingOrganization>\n  </tns:leadOrganization>\n  <tns:pi>\n    <tns:existingPerson>\n      <tns:poID>5000</tns:poID>\n    </tns:existingPerson>\n  </tns:pi>\n  <tns:sponsor>\n    <tns:existingOrganization>\n      <tns:poID>181802</tns:poID>\n    </tns:existingOrganization>\n  </tns:sponsor>\n  <tns:responsibleParty>\n    <tns:type>Sponsor-Investigator</tns:type>\n    <tns:investigator>\n      <tns:existingPerson>\n        <tns:poID>5000</tns:poID>\n      </tns:existingPerson>\n    </tns:investigator>\n    <tns:investigatorTitle>CEO &amp; Chairman</tns:investigatorTitle>\n  </tns:responsibleParty>\n  <tns:summary4FundingSponsor>\n    <tns:existingOrganization>\n      <tns:poID>181802</tns:poID>\n    </tns:existingOrganization>\n  </tns:summary4FundingSponsor>\n  <tns:programCode>PG00001</tns:programCode>\n  <tns:fundedByNciGrant>false</tns:fundedByNciGrant>\n  <tns:grant>\n    <tns:fundingMechanism>B09</tns:fundingMechanism>\n    <tns:nihInstitutionCode>AA</tns:nihInstitutionCode>\n    <tns:serialNumber>111111</tns:serialNumber>\n    <tns:nciDivisionProgramCode>CCR</tns:nciDivisionProgramCode>\n    <tns:fundingPercentage>100.0</tns:fundingPercentage>\n  </tns:grant>\n  <tns:trialStatus>In Review</tns:trialStatus>\n  <tns:whyStopped></tns:whyStopped>\n  <tns:trialStatusDate>2014-07-15</tns:trialStatusDate>\n  <tns:trialStartDate type=\"Actual\">2014-07-15</tns:trialStartDate>\n  <tns:primaryCompletionDate type=\"Anticipated\">2019-07-15</tns:primaryCompletionDate>\n  <tns:completionDate type=\"Anticipated\">2019-07-15</tns:completionDate>\n  <tns:ind>\n    <tns:number>111111</tns:number>\n    <tns:grantor>CDER</tns:grantor>\n    <tns:holderType>NIH</tns:holderType>\n    <tns:nihInstitution>NEI</tns:nihInstitution>\n    <tns:expandedAccess>true</tns:expandedAccess>\n    <tns:expandedAccessType>Available</tns:expandedAccessType>\n    <tns:exempt>true</tns:exempt>\n  </tns:ind>\n  <tns:ide>\n    <tns:number>222222</tns:number>\n    <tns:grantor>CDRH</tns:grantor>\n    <tns:holderType>NCI</tns:holderType>\n    <tns:nciDivisionProgramCode>CCR</tns:nciDivisionProgramCode>\n    <tns:expandedAccess>true</tns:expandedAccess>\n    <tns:expandedAccessType>Available</tns:expandedAccessType>\n    <tns:exempt>true</tns:exempt>\n  </tns:ide>\n  <tns:regulatoryInformation>\n    <tns:country>USA</tns:country>\n    <tns:authorityName>Federal Government</tns:authorityName>\n    <tns:fdaRegulated>true</tns:fdaRegulated>\n    <tns:section801>true</tns:section801>\n    <tns:delayedPosting>true</tns:delayedPosting>\n    <tns:dataMonitoringCommitteeAppointed>true</tns:dataMonitoringCommitteeAppointed>\n  </tns:regulatoryInformation>\n  <tns:protocolDocument filename=\"protocol.pdf\">dGVzdA==</tns:protocolDocument>\n  <tns:irbApprovalDocument filename=\"irb.pdf\">dGVzdA==</tns:irbApprovalDocument>\n  <tns:participatingSitesDocument\n          filename=\"sites.pdf\">dGVzdA==</tns:participatingSitesDocument>\n  <tns:informedConsentDocument filename=\"consent.pdf\">dGVzdA==</tns:informedConsentDocument>\n  <tns:otherDocument filename=\"other.pdf\">dGVzdA==</tns:otherDocument>\n  <tns:category>Externally Peer-Reviewed</tns:category>\n  <tns:trialOwner>qatest@nih.gov</tns:trialOwner>\n</tns:CompleteTrialRegistration>\n','JBAS014580: Unexpected Error','500','1012','');
      INSERT INTO webservice_access_log (identifier,datetime,client_ip,client_username,uri,method,headers,payload,response,response_code,processing_time,processing_errors) VALUES ('1618428','2018-02-21 08:34:55.261','172.18.0.1','ctrpsubstractor','/services/trials/complete/','POST','host=localhost:18080\nconnection=keep-alive\ncontent-length=4516\naccept=application/xml\npostman-token=67d3475f-2ca6-739b-c640-9757b881060b\ncache-control=no-cache\norigin=chrome-extension://fhbjgbiflinjbdggehcddcbncdddomop\nuser-agent=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/64.0.3282.167 Safari/537.36\nauthorization=*********\ncontent-type=application/xml\naccept-encoding=gzip, deflate, br\naccept-language=en-US,en;q=0.9\ncookie=JSESSIONID=syajca7WdyZiqoJN+WrkNoFO\n','<tns:CompleteTrialRegistration xmlns:tns=\"gov.nih.nci.pa.webservices.types\"\n                               xmlns:tns1=\"gov.nih.nci.po.webservices.types.trimmed\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n                               xsi:schemaLocation=\"gov.nih.nci.pa.webservices.types ../../src/resources/ws.xsd \">\n\n  <tns:clinicalTrialsDotGovXmlRequired>true</tns:clinicalTrialsDotGovXmlRequired>\n  <tns:leadOrgTrialID>UPCC 348-02 II - sa2</tns:leadOrgTrialID>\n  <tns:clinicalTrialsDotGovTrialID>NCT91914277</tns:clinicalTrialsDotGovTrialID>\n  <tns:otherTrialID>818280244</tns:otherTrialID>\n  <tns:title>A Phase I/II Study Of Brentuximab Vedotin In Combination With Multi-Agent Chemotherapy II</tns:title>\n  <tns:phase>I</tns:phase>\n  <tns:pilot>false</tns:pilot>\n  <tns:accrualDiseaseTerminology>ICD10</tns:accrualDiseaseTerminology>\n  <tns:primaryPurpose>Other</tns:primaryPurpose>\n  <tns:primaryPurposeOtherDescription>Determine maximum tolerated dose (MTD) of brentuximab vedotin</tns:primaryPurposeOtherDescription>\n  <tns:interventionalDesign>\n    <tns:secondaryPurpose>Other</tns:secondaryPurpose>\n    <tns:secondaryPurposeOtherDescription>Secondary Other Description</tns:secondaryPurposeOtherDescription>\n  </tns:interventionalDesign>\n  <tns:leadOrganization>\n    <tns:existingOrganization>\n      <tns:poID>181802</tns:poID>\n    </tns:existingOrganization>\n  </tns:leadOrganization>\n  <tns:pi>\n    <tns:existingPerson>\n      <tns:poID>5000</tns:poID>\n    </tns:existingPerson>\n  </tns:pi>\n  <tns:sponsor>\n    <tns:existingOrganization>\n      <tns:poID>181802</tns:poID>\n    </tns:existingOrganization>\n  </tns:sponsor>\n  <tns:responsibleParty>\n    <tns:type>Sponsor-Investigator</tns:type>\n    <tns:investigator>\n      <tns:existingPerson>\n        <tns:poID>5000</tns:poID>\n      </tns:existingPerson>\n    </tns:investigator>\n    <tns:investigatorTitle>CEO &amp; Chairman</tns:investigatorTitle>\n  </tns:responsibleParty>\n  <tns:summary4FundingSponsor>\n    <tns:existingOrganization>\n      <tns:poID>181802</tns:poID>\n    </tns:existingOrganization>\n  </tns:summary4FundingSponsor>\n  <tns:programCode>PG00001</tns:programCode>\n  <tns:fundedByNciGrant>false</tns:fundedByNciGrant>\n  <tns:grant>\n    <tns:fundingMechanism>B09</tns:fundingMechanism>\n    <tns:nihInstitutionCode>AA</tns:nihInstitutionCode>\n    <tns:serialNumber>111111</tns:serialNumber>\n    <tns:nciDivisionProgramCode>CCR</tns:nciDivisionProgramCode>\n    <tns:fundingPercentage>100.0</tns:fundingPercentage>\n  </tns:grant>\n  <tns:trialStatus>In Review</tns:trialStatus>\n  <tns:whyStopped></tns:whyStopped>\n  <tns:trialStatusDate>2014-07-15</tns:trialStatusDate>\n  <tns:trialStartDate type=\"Actual\">2014-07-15</tns:trialStartDate>\n  <tns:primaryCompletionDate type=\"Anticipated\">2019-07-15</tns:primaryCompletionDate>\n  <tns:completionDate type=\"Anticipated\">2019-07-15</tns:completionDate>\n  <tns:ind>\n    <tns:number>111111</tns:number>\n    <tns:grantor>CDER</tns:grantor>\n    <tns:holderType>NIH</tns:holderType>\n    <tns:nihInstitution>NEI</tns:nihInstitution>\n    <tns:expandedAccess>true</tns:expandedAccess>\n    <tns:expandedAccessType>Available</tns:expandedAccessType>\n    <tns:exempt>true</tns:exempt>\n  </tns:ind>\n  <tns:ide>\n    <tns:number>222222</tns:number>\n    <tns:grantor>CDRH</tns:grantor>\n    <tns:holderType>NCI</tns:holderType>\n    <tns:nciDivisionProgramCode>CCR</tns:nciDivisionProgramCode>\n    <tns:expandedAccess>true</tns:expandedAccess>\n    <tns:expandedAccessType>Available</tns:expandedAccessType>\n    <tns:exempt>true</tns:exempt>\n  </tns:ide>\n  <tns:regulatoryInformation>\n    <tns:country>USA</tns:country>\n    <tns:authorityName>Federal Government</tns:authorityName>\n    <tns:fdaRegulated>true</tns:fdaRegulated>\n    <tns:section801>true</tns:section801>\n    <tns:delayedPosting>true</tns:delayedPosting>\n    <tns:dataMonitoringCommitteeAppointed>true</tns:dataMonitoringCommitteeAppointed>\n  </tns:regulatoryInformation>\n  <tns:protocolDocument filename=\"protocol.pdf\">dGVzdA==</tns:protocolDocument>\n  <tns:irbApprovalDocument filename=\"irb.pdf\">dGVzdA==</tns:irbApprovalDocument>\n  <tns:participatingSitesDocument\n          filename=\"sites.pdf\">dGVzdA==</tns:participatingSitesDocument>\n  <tns:informedConsentDocument filename=\"consent.pdf\">dGVzdA==</tns:informedConsentDocument>\n  <tns:otherDocument filename=\"other.pdf\">dGVzdA==</tns:otherDocument>\n  <tns:category>Externally Peer-Reviewed</tns:category>\n  <tns:trialOwner>qatest@nih.gov</tns:trialOwner>\n</tns:CompleteTrialRegistration>\n','<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>\n<TrialRegistrationConfirmation xmlns=\"gov.nih.nci.pa.webservices.types\" xmlns:ns2=\"gov.nih.nci.po.webservices.types.trimmed\">\n    <paTrialID>1618195</paTrialID>\n    <nciTrialID>NCI-2018-03030</nciTrialID>\n</TrialRegistrationConfirmation>\n','200','6255','');
     "
     puts sql_insert_webservice_access_log
end

# insert_webservice_access_log 'ST20182602A'
